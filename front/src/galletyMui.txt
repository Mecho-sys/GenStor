const checkDeselect = (e) => {
    if (creatingLine) {
      if (startCoords.x == null && startCoords.y == null) {
        const selectedShape =
          rectangles.find((rect) => rect.id === selectedId) ||
          circles.find((circle) => circle.id === selectedId);
        if (selectedShape) {
          setStartCoords({
            x: selectedShape.radius
              ? selectedShape.x
              : selectedShape.x + selectedShape.width / 2,
            y: selectedShape.radius
              ? selectedShape.y
              : selectedShape.y + selectedShape.height / 2,
          });
          console.log(
            "Primer figura seleccionada:",
            selectedShape.radius ? "Círculo" : "Rectángulo"
          );
        }
      } else {
        const selectedShape =
          rectangles.find((rect) => rect.id === selectedId) ||
          circles.find((circle) => circle.id === selectedId);
        if (selectedShape) {
          setEndCoords({
            x: selectedShape.radius
              ? selectedShape.x
              : selectedShape.x + selectedShape.width / 2,
            y: selectedShape.radius
              ? selectedShape.y
              : selectedShape.y + selectedShape.height / 2,
          });
          console.log(
            "Segunda figura seleccionada:",
            selectedShape.radius ? "Círculo" : "Rectángulo"
          );
        }

        setCreatingLine(false);

        // Crea la línea con las coordenadas iniciales y finales
        const currentLines = [...lines];
        const newId = `line${currentLines.length + 1}`;
        const newLine = {
          points: [startCoords.x, startCoords.y, endCoords.x, endCoords.y],
          stroke: "black",
          strokeWidth: 2,
          id: newId,
        };
        currentLines.push(newLine);
        setLines(currentLines);

        setStartCoords({ x: null, y: null });
        setEndCoords({ x: null, y: null });

        console.log("Se añadió una línea");
      }
    } else {
      // Si no estamos en modo creación de línea, deselecciona la figura
      const clickedOnEmpty = e.target === e.target.getStage();
      if (clickedOnEmpty) {
        selectShape(null);
      }
    }
  };


  if (creatingLinePunt) {
      // Guarda las coordenadas iniciales al inicio del proceso de creación de la línea
      if (startCoords.x == null && startCoords.y == null) {
        setStartCoords({ x: e.target.x(), y: e.target.y() });
        console.log("primer figura seleccionada");
      } else {
        // Si estamos en modo creación de línea, guarda las coordenadas finales
        setEndCoords({ x: e.target.x(), y: e.target.y() });
        console.log("segunda figura seleccionada");

        // Crea la línea con las coordenadas iniciales y finales
        const currentLines = [...lines];
        const newId = `line${currentLines.length + 1}`;
        const newLine = {
          points: [
            startCoords.x + 50,
            startCoords.y + 100,
            startCoords.x + 50,
            startCoords.y + 150,
            e.target.x(),
            e.target.y() + 100,
            e.target.x(),
            e.target.y() + 50,
          ],
          stroke: "black",
          strokeWidth: 2,
          dash: [10, 5],
          id: newId,
        };
        currentLines.push(newLine);
        setLines(currentLines);

        // Reinicia las coordenadas para el próximo par de clics
        setStartCoords({ x: null, y: null });
        setEndCoords({ x: null, y: null });
        setCreatingLinePunt(false);
        console.log("Se añadió una línea");
      }
    }